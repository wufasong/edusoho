webpackJsonp(["app/js/testpaper-manage/questions/index"],{0:function(t,e){t.exports=jQuery},"1e0cf618bc778b8ab554":function(t,e,a){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("7ab4a89ebadbfdecc2bf"),n=s(i),r=a("4602c3f5fe7ad9e3e91d"),o=s(r),d=a("b334fd7e4c5a19234db2"),c=s(d),u=a("71e1df85d5928925f4b1"),l=function(){function t(e,a){(0,n.default)(this,t),this.$form=e,this.$modal=a,this.initEvent()}return(0,o.default)(t,[{key:"initEvent",value:function(){var t=this;this.$form.on("click",'[data-role="item-delete-btn"]',function(e){return t.deleteQuestion(e)}),this.$form.on("click",'[data-role="replace-item"]',function(e){return t.replaceQuestion(e)}),this.$form.on("click",'[data-role="preview-btn"]',function(e){return t.previewQuestion(e)}),this.$form.on("click",'[data-role="batch-delete-btn"]',function(e){return t.batchDelete(e)}),this.initSortList()}},{key:"initSortList",value:function(){var t=this,e=void 0,a=this.$form.find("tbody"),s=a.hasClass("js-homework-table")?"":"<td></td>",i='<tr class="question-placehoder js-placehoder"><td></td><td></td><td></td><td></td><td></td><td></td><td></td>'+s+"</tr>";a.sortable({containerPath:"> tr",containerSelector:"tbody",itemSelector:"tr.is-question",placeholder:i,exclude:".notMoveHandle",onDragStart:function(t,a,s){t.hasClass("have-sub-questions")||$(".js-have-sub").removeClass("is-question");var i=t.offset(),n=a.rootGroup.pointer;e={left:n.left-i.left,top:n.top-i.top},s(t,a)},onDrag:function(t,a){var s=t.height();t.css({left:a.left-e.left,top:a.top-e.top}),$(".js-placehoder").css({height:s})},onDrop:function(e,a,s){if(s(e,a),e.hasClass("have-sub-questions")){var i=e.parents("tbody");i.find("tr.is-question").each(function(){var t=$(this);i.find("[data-parent-id="+t.data("id")+"]").detach().insertAfter(t)})}else $(".js-have-sub").addClass("is-question");t.refreshSeqs()}})}},{key:"replaceQuestion",value:function(t){var e=this,a=$(t.currentTarget),s=[],i=this.$form.find("tbody:visible");i.find('[name="questionIds[]"]').each(function(){s.push($(this).val())}),this.$modal.data("manager",this).modal(),$.get(a.data("url"),{excludeIds:s.join(","),type:i.data("type")},function(t){e.$modal.html(t)})}},{key:"deleteQuestion",value:function(t){t.stopPropagation();var e=$(t.currentTarget),a=e.closest("tr").data("id");e.closest("tbody").find('[data-parent-id="'+a+'"]').remove(),e.closest("tr").remove(),(0,u.questionSubjectiveRemask)(this.$form),this.refreshSeqs()}},{key:"batchDelete",value:function(t){if(0==this.$form.find('[data-role="batch-item"]:checked').length){var e=this.$form.find(".js-help-redmine");e?(e.text(Translator.trans("activity.testpaper_manage.question_required_error_hint")).show(),setTimeout(function(){e.slideUp()},3e3)):(0,c.default)("danger",Translator.trans("activity.testpaper_manage.question_required_error_hint"))}var a=this;this.$form.find('[data-role="batch-item"]:checked').each(function(t,e){var s=$(this).val();"material"==$(this).closest("tr").data("type")&&a.$form.find('[data-parent-id="'+s+'"]').remove(),$(this).closest("tr").remove()}),(0,u.questionSubjectiveRemask)(this.$form)}},{key:"previewQuestion",value:function(t){t.preventDefault(),window.open($(t.currentTarget).data("url"),"_blank","directories=0,height=580,width=820,scrollbars=1,toolbar=0,status=0,menubar=0,location=0")}},{key:"refreshSeqs",value:function(){var t=1;this.$form.find("tbody tr").each(function(){var e=$(this);e.hasClass("have-sub-questions")||(e.find("td.seq").html(t),t++)}),this.$form.find('[name="questionLength"]').val(t-1>0?t-1:null)}}]),t}();e.default=l},"65c0e24ccad86ee24949":function(t,e,a){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("6415c664294d747ee392"),n=s(i),r=a("7ab4a89ebadbfdecc2bf"),o=s(r),d=a("4602c3f5fe7ad9e3e91d"),c=s(d),u=a("b334fd7e4c5a19234db2"),l=s(u),h=function(){function t(e){(0,o.default)(this,t),this.$element=e,this.$button=this.$element.find('[data-role="pick-item"]'),this.$typeNav=this.$element.find("#testpaper-question-nav"),this.$modal=$("#testpaper-confirm-modal"),this.currentType=this.$typeNav.find(".active").children().data("type"),this.questions=[],this.questionsCount=0,this._initEvent()}return(0,c.default)(t,[{key:"_initEvent",value:function(){var t=this;this.$button.on("click",function(e){return t._showPickerModal(e)}),this.$typeNav.on("click","li",function(e){return t._changeNav(e)}),this.$element.on("click",".js-request-save",function(e){return t._confirmSave(e)}),this.$modal.on("click",".js-confirm-submit",function(e){return t._submitSave(e)})}},{key:"_showPickerModal",value:function(){var t=[];$('[data-type="'+this.currentType+'"]').find('[name="questionIds[]"]').each(function(){t.push($(this).val())});var e=$("#modal").modal();e.data("manager",this),$.get(this.$button.data("url"),{excludeIds:t.join(","),type:this.currentType},function(t){e.html(t)})}},{key:"_changeNav",value:function(t){var e=$(t.currentTarget),a=e.children().data("type");this.currentType=a,this.$typeNav.find("li").removeClass("active"),e.addClass("active"),this.$element.find('[data-role="question-body"]').addClass("hide"),this.$element.find("#testpaper-items-"+a).removeClass("hide"),this.$element.find('[data-role="batch-select"]').prop("checked",!1),this.$element.find('[data-role="batch-item"]').prop("checked",!1)}},{key:"_confirmSave",value:function(){if(this._validateScore()){this.questionsCount=0,this.questions=[];var t=this._calTestpaperStats(),e="";$.each(t,function(t,a){var s="<tr>";s+="<td>"+a.name+"</td>",s+="<td>"+a.count+"</td>",s+="<td>"+a.score.toFixed(1)+"</td>",s+="</tr>",e+=s}),this.$modal.find(".detail-tbody").html(e),this._showSubjectiveRemaskIfNoEssay(),this.$modal.modal("show")}}},{key:"_validateScore",value:function(){var t=!0;return 0==this.$element.find('[name="scores[]"]').length&&((0,l.default)("danger",Translator.trans("activity.testpaper_manage.question_required_error_hint")),t=!1),this.$element.find('input[type="text"][name="scores[]"]').each(function(){var e=$(this).val();"0"==e&&((0,l.default)("danger",Translator.trans("activity.testpaper_manage.question_score_empty_hint")),t=!1),/^(([1-9]{1}\d{0,2})|([0]{1}))(\.(\d){1})?$/.test(e)||((0,l.default)("danger",Translator.trans("activity.testpaper_manage.question_score_error_hint")),$(this).focus(),t=!1)}),t}},{key:"_calTestpaperStats",value:function(){var t={},e=this;this.$typeNav.find("li").each(function(){var a=$(this).find("a").data("type"),s=$(this).find("a").data("name");t[a]={name:s,count:0,score:0,missScore:0},e.$element.find("#testpaper-items-"+a).find('[name="scores[]"]').each(function(){var s=$(this).closest("tr").data("type"),i="material"==s?0:parseFloat($(this).val()),n={};"material"!=s&&t[a].count++,t[a].score+=i,t[a].missScore=parseFloat($(this).data("miss-score"));var r=$(this).closest("tr").data("id");n.id=r,n.score=i,n.missScore=parseFloat($(this).data("miss-score")),n.type=a,e.questions.push(n)})});var a={name:Translator.trans("activity.testpaper_manage.question_total_score"),count:0,score:0};return $.each(t,function(t,e){a.count+=e.count,a.score+=e.score}),t.total=a,e.questionsCount=a.count,t}},{key:"_showSubjectiveRemaskIfNoEssay",value:function(){var t=$(".js-subjective-remask"),e=$('#testpaper-table tr[data-type="essay"]');e.length>0&&!t.hasClass("hidden")&&t.addClass("hidden"),0===e.length&&t.hasClass("hidden")&&t.removeClass("hidden")}},{key:"_submitSave",value:function(t){var e=0,a=$(t.currentTarget);if($('[name="passedScore"]').length>0){var s=$(".passedScoreDiv").siblings(".help-block").html();if(""!==$.trim(s))return}this.questionsCount=0,this.questions=[];var i=this._calTestpaperStats();if($('[name="passedScore"]:visible').length>0){if((e=$('input[name="passedScore"]').val())>i.total.score)return void(0,l.default)("danger",Translator.trans("activity.testpaper_manage.setting_pass_score_error_hint",{passedScore:e,totalScore:i.total.score}));if(!/^(([1-9]\d{0,2})|([0]))(\.(\d))?$/.test(e))return(0,l.default)("danger",Translator.trans("activity.testpaper_manage.pass_score_error_hint")),void $(this).focus()}this.questionsCount>2e3?(0,l.default)("danger",Translator.trans("activity.testpaper_manage.questions_length_hint")):(a.button("loading").addClass("disabled"),$.post(this.$element.attr("action"),{questions:(0,n.default)(this.questions),passedScore:e},function(t){t.goto&&(window.location.href=t.goto)}))}}]),t}();e.default=h},"71e1df85d5928925f4b1":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.questionSubjectiveRemask=function(t){var e=!1,a="",s=$("#task-create-content-iframe").contents().find(".js-subjective-remask");if(t.find("tbody tr").each(function(){var t=$(this).data("type");"essay"==t&&(e=!0)}),e||0==t.find("tbody tr").length)return void s.html("");a="homework"==s.data("type")?Translator.trans("activity.homework_manage.objective_question_hint"):Translator.trans("activity.homework_manage.pass_objective_question_hint"),s.html(a).removeClass("hidden")}},ce77bc9ba67272358705:function(t,e,a){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}a("015a62750c9975765604");var i=a("de585ca0d3c2d0205c51"),n=s(i),r=a("1e0cf618bc778b8ab554"),o=s(r),d=a("65c0e24ccad86ee24949"),c=s(d),u=$("#testpaper-items-manager");new o.default(u,$("#modal")),new c.default(u),new n.default(u)}},["ce77bc9ba67272358705"]);