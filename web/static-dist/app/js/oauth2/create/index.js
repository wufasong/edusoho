webpackJsonp(["app/js/oauth2/create/index"],{0:function(e,t){e.exports=jQuery},"04e12e97a64b943320e3":function(e,t,a){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a("7ab4a89ebadbfdecc2bf"),r=s(n),d=a("4602c3f5fe7ad9e3e91d"),i=s(d),o=a("e104a65d9efb9ac573bc"),c=a("b334fd7e4c5a19234db2"),u=(s(c),a("0fcd3a355c9fe74234e3")),l=a("5eb223de522186da1dd9"),h=s(l),f=a("bbc0ef257199acca9fed"),m=s(f),g=function(){function e(){(0,r.default)(this,e),this.$form=$("#third-party-create-account-form"),this.$btn=$(".js-submit-btn"),this.validator=null,this.dragCaptchaToken="",this.smsToken=null,this.$sendBtn=$(".js-sms-send"),this.drag=!!$("#drag-btn").length&&new m.default($("#drag-btn"),$(".js-jigsaw"),{limitType:"bind_register"}),this.init()}return(0,i.default)(e,[{key:"init",value:function(){this.initValidator(),this.smsSend(),this.submitForm(),this.removeSmsErrorTip(),this.dragEvent()}},{key:"dragEvent",value:function(){var e=this;this.drag&&this.drag.on("success",function(t){e.$sendBtn.attr("disabled",!1),e.dragCaptchaToken=t.token}),$(".js-drag-jigsaw").hasClass("hidden")||this.addDragCaptchaRules()}},{key:"initValidator",value:function(){this.rules={username:{required:!0,byte_minlength:4,byte_maxlength:18,nickname:!0,chinese_alphanumeric:!0,es_remote:{type:"get"}},invitedCode:{required:!1,reg_inviteCode:!0,es_remote:{type:"get"}},password:{required:!0,minlength:5,maxlength:20},confirmPassword:{required:!0,equalTo:"#password"},sms_code:{required:!0,unsigned_integer:!0,rangelength:[6,6]}},this.validator=this.$form.validate({rules:this.rules,messages:{sms_code:{required:Translator.trans("site.captcha_code.required"),rangelength:Translator.trans("validate.sms_code.message")}}})}},{key:"smsSend",value:function(){var e=this,t=this,a=$("#captcha_code");this.$sendBtn.length&&this.$sendBtn.click(function(s){t.smsSended||($.ajaxSetup({global:!1}),t.smsSended=!0),t.$sendBtn.attr("disabled",!0);var n={type:"register",mobile:$(".js-account").text(),dragCaptchaToken:e.dragCaptchaToken,phrase:a.val()};h.default.sms.send({data:n}).then(function(t){$.ajaxSetup({global:!0}),e.smsToken=t.smsToken,(0,u.countDown)(120)}).catch(function(e){t.drag&&($.ajaxSetup({global:!0}),t.addDragCaptchaRules(),t.drag.initDragCaptcha(),$(".js-drag-jigsaw").removeClass("hidden"))})})}},{key:"submitForm",value:function(){var e=this;this.$btn.click(function(t){var a=$(t.target);if(e.validator.form()){a.button("loading");var s={nickname:$("#username").val(),password:$("#password").val(),mobile:$(".js-account").html(),smsToken:e.smsToken,smsCode:$("#sms-code").val(),captchaToken:e.captchaToken,phrase:$("#captcha_code").val(),dragCaptchaToken:$('[name="dragCaptchaToken"]').val(),invitedCode:$("#invitedCode").length>0?$("#invitedCode").val():""},n=Translator.trans("oauth.send.sms_code_error_tip");$.post(a.data("url"),s,function(e){a.button("reset"),1===e.success?window.location.href=e.url:$(".js-password-error").length||a.prev().addClass("has-error").append('<p id="password-error" class="form-error-message js-password-error">'+n+"</p>")}).error(function(e){a.button("reset")})}}),(0,o.enterSubmit)(this.$form,this.$btn)}},{key:"addDragCaptchaRules",value:function(){$('[name="dragCaptchaToken"]').rules("add",{required:!0,messages:{required:Translator.trans("auth.register.drag_captcha_tips")}})}},{key:"removeSmsErrorTip",value:function(){$("#sms-code").focus(function(){var e=$(".js-password-error");e.length&&e.remove()})}}]),e}();t.default=g},"0fcd3a355c9fe74234e3":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.countDown=void 0;var s=a("b334fd7e4c5a19234db2"),n=function(e){return e&&e.__esModule?e:{default:e}}(s),r=$(".js-time-left"),d=$(".js-sms-send"),i=$(".js-fetch-btn-text"),o=(t.countDown=function(e){r.html(e),i.html(Translator.trans("site.data.get_sms_code_again_btn")),(0,n.default)("success",Translator.trans("site.data.get_sms_code_success_hint")),o()},function e(){var t=r.text();r.html(t-1),t-1>0?(d.attr("disabled",!0),setTimeout(e,1e3)):(r.html(""),i.html(Translator.trans("oauth.send.validate_message")),d.removeAttr("disabled"))})},"1d43a4025aadc22df310":function(e,t,a){"use strict";var s=a("04e12e97a64b943320e3");new(function(e){return e&&e.__esModule?e:{default:e}}(s).default)},e104a65d9efb9ac573bc:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(e,t){e.keypress(function(e){13==e.which&&(t.trigger("click"),e.preventDefault())})};t.enterSubmit=s}},["1d43a4025aadc22df310"]);